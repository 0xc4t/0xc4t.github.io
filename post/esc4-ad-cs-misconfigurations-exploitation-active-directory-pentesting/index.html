<!DOCTYPE html>
<!-- saved from url=(0114)https://0xc4t.github.io/content.html?p=md/esc4-ad-cs-misconfigurations-exploitation-active-airectory-pentesting.md -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC4 ADCS Misconfigurations exploitation — Active Directory Pentesting</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="ESC4 ADCS Misconfigurations exploitation — Active Directory Pentesting">
    <meta property="og:description" content="ESC4 is one of the vulnerabilities in the Active Directory Certificate Services (AD CS) Abuse category discovered by Will Schroeder and Lee Christensen. ESC4 refers to improper abuse of access rights on the Certificate Template in AD CS, which allows an attacker to modify the certificate template and use it for privilege escalation or take over domain control.">
    <meta property="og:site_name" content="0xc4t Posts">
    <meta property="og:image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/1*5vcTfAIRulqT0MAq4HxjpA.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <link rel="stylesheet" href="../../style.css">
    <link rel="icon" type="image/x-icon" href="https://pbs.twimg.com/profile_images/1960719102932344837/T8Sl7V0i_400x400.jpg">
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "81ab0317a4f24dde96e3b68dd2b1e0e3"}'></script>
  </head>
  <body>
    <h1>./0xc4t.re</h1>
    <p class="slogan">
      <i>Web Security &amp; Active Directory Security</i>
    </p>
    <nav>
      <a href="/index.html">/posts</a>
      <a href="/about">/about</a>
    </nav>
    <hr>
    <div id="content" class="content"><h2>ESC4 ADCS Misconfigurations exploitation — Active Directory Pentesting</h2>
<p>Just today I was learning about how to exploit vulnerabilities in ADCS (Active Directory Certificate Services), I was interested enough to learn about it that I wanted to make notes for this vulnerability in the medium, ESC4 itself is one of the misconfigurations contained in the active directory, therefore in this article I will try to discuss this ADCS misconfig (as notes only).</p>
<h3>ADCS (Active Directory Certificate Services)</h3>
<p>Active Directory Certificate Services is one of the many services available on Windows Server, which allows organizations to create, manage, and distribute digital certificates. These digital certificates are used for various security purposes, such as authentication, encryption, and digital signatures. AD CS is a key component in Microsoft’s Public Key Infrastructure (PKI) infrastructure. For details you can learn through this article www.1kosmos.com/security-glossary/active-directory-certificate-services/</p>
<h3>What is ESC4</h3>
<p>ESC4 is one of the vulnerabilities in the Active Directory Certificate Services (AD CS) Abuse category discovered by Will Schroeder and Lee Christensen. ESC4 refers to improper abuse of access rights on the Certificate Template in AD CS, which allows an attacker to modify the certificate template and use it for privilege escalation or take over domain control.</p>
<h3>Setup Lab</h3>
<p>Open the Certificate Templates Console using WIN + R then type</p>
<pre><code class="language-bash">certtmpl.msc
</code></pre>
<p><img src="1_CbGSr4TOVshA61IrLbaqQA.webp" alt="alt text">
Right-click on the User template and duplicate</p>
<hr>
<p><img src="1_YpulsgUdIaqAvQyw6UpRaQ.webp" alt="alt text">
In the general menu name the new template in this case I make the name so “ESC4-Secure”</p>
<hr>
<p><img src="1_UO8-pxaTit-9Cd8WEEmi9Q.webp" alt="alt text">
Click the subject menu and check the supply section in the request.</p>
<hr>
<p><img src="1_DdWj7oQS3nnX0qXLB8758g.webp" alt="alt text">
Set the Authenticated Users group permission to full control in the security menu and then apply it.</p>
<hr>
<p>To make the certificate template complete, when we turn on the certificate that has been made, follow the following instructions</p>
<p>Run Certsrc with WIN + R</p>
<pre><code class="language-bash">certsrv.msc
</code></pre>
<p><img src="1_GIdTzlglweSnQAgyfvsKPw.webp" alt="alt text">
Click the action menu then select new &gt; Certificate Template To Issue</p>
<hr>
<p><img src="1_E_-Ck36pXEePA_KlMQGJ2w.webp" alt="alt text">
Select the certificate that we created earlier and OK.</p>
<hr>
<p>Done you have successfully misconfigured ESC4 on ADCS, therefore let’s do exploitation, before that you need certipy tools, you can install through the github repository or through packages that are already available on the Linux operating system, ok proceed to the exploitation stage.</p>
<p>I almost forgot to tell you to do this exploit you must have 1 account that has been obtained to access to AD, Identify vulnerabilities or configure ESC4 with the following command</p>
<pre><code class="language-bash">sudo certipy find -vulnerable -hide-admins -u jake.doe@wtbank.local -p iloveyou -dc-ip 10.10.10.10 -stdout -enabled
</code></pre>
<p>The output will look like this</p>
<p><img src="1_5vcTfAIRulqT0MAq4HxjpA.webp" alt="alt text">
It can be seen in the output that the Authenticated Users group has very high permissions this means that there is a misconfiguration of ESC4 on ADCS and we can exploit it !!!</p>
<h3>Make requests using templates that have misconfigurations!!!</h3>
<p><img src="1_vWhiDH5ORIjNHG8MFUpGvw.webp" alt="alt text">
from the picture above we have obtained the NTLM hash from the administrator and we just use it to log in maybe through evil-winrm, samba, or services on the DC.</p>
<p><img src="1_PCG0VarYjBCaCfJ5BUAMUg.webp" alt="alt text">
Maybe that’s all for me, if there are mistakes when explaining, please correct them in the comments, because your criticism or suggestions are useful for our friends who are learning, thanks.</p>
</div>

    <div class="social-icons">
      <a href="https://www.instagram.com/0xc4t?utm_source=ig_web_button_share_sheet&amp;igsh=ZDNlZDc0MzIxNw==" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://x.com/0x0c4t" target="_blank"><i class="fab fa-x-twitter"></i></a>
    </div>
    <div class="footer">
      © 2025 0xc4t
    </div>


</body></html>
